{{TAGDEF|LORBIT|0 {{!}} 1 {{!}} 2 {{!}} 5 {{!}} 10 {{!}} 11 {{!}} 12 | 0 }}

Description: Selects a projection method onto local quantum numbers (<math>lm</math>) and writes {{FILE|PROCAR}}/{{FILE|PROOUT}} file.
----

When {{TAG|LORBIT}} is set, VASP performs a post-processing step of the Kohn-Sham (KS) orbitals to decompose the KS orbitals into local quantum numbers (<math>lm</math>) and obtain local properties, e.g., the on-site charge density or on-site magnetic moments due to the spin degrees of freedom. The decomposition is achieved by means of one of several projection methods selected by {{TAG|LORBIT}}. All these projections rely on the fact that most of the charge density is close to the ion center, and interstitial regions separate them well. This is merely a qualitative approach in contrast to performing a [[Wannier functions|wannierization]] in order to obtain a localized basis, but often it serves as a good estimate.
{{NB|tip| As this is a post-processing step, {{TAG|LORBIT}} can be added/changed when restarting a converged calculation. To this end, set {{TAG|ALGO}}{{=}}None and the desired {{TAG|LORBIT}}, and restart from {{FILE|WAVECAR}}.}}
For VASP version < 6 with {{TAG|LORBIT}} >= 11 and {{TAG|ISYM}} = 2, see [[Known issues|known issues]].
== Projection methods ==
See the table for an overview:

:{| border="1" cellspacing="0" cellpadding="5"
|{{TAG|LORBIT}} || {{TAG|RWIGS}} tag || files written
|-
| 0 || required || {{FILE|DOSCAR}} and {{FILE|PROCAR}}
|-
| 1 || required || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}}
|-
| 2 || required || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}} + phase factors
|-
| 5 || required || {{FILE|DOSCAR}} and {{FILE|PROOUT}}
|-
| 10 || ignored || {{FILE|DOSCAR}} and {{FILE|PROCAR}}
|-
| 11 || ignored || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}}
|-
| 12 || ignored || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}} + phase factors (not recommended)
|-
| 13 || ignored || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}} + phase factors, choose best projector for each band (not recommended)
|-
| 14 || ignored || {{FILE|DOSCAR}} and ''lm''-decomposed {{FILE|PROCAR}} + phase factors, choose single projector for interval {{TAG|EMIN}},{{TAG|EMAX}}
|}

=== For {{TAG|LORBIT}} < 10 ===
The projection is onto spherical harmonics at each ionic site within a sphere defined by {{TAG|RWIGS}}. The radius must be specified for each atomic species, and there is some uncertainty introduced depending on the size of the sphere.

=== For {{TAG|LORBIT}} >= 10 ===
The projection uses the projector functions that are provided by the [[PAW formalism|PAW method]]. This is, of course, still a qualitative approach because also, for the PAW projectors, the radius was somehow defined, and it is not guaranteed to be the best choice for that particular system as it depends on the chemical composition and crystal or molecular structure.

=== Phase factors ===

For {{TAG|LORBIT}}>=12:
The '''phase factors''' written by VASP can usually only be used as a qualitative measure of the projection of the orbitals into the atomic sphere. The main issue is that most VASP {{FILE|POTCAR}} files have two or three projectors per <math>l</math>-quantum number, and projecting an orbital onto two projectors will yield two complex numbers. VASP combines these two numbers into a single number. The precise algorithms differ in different versions of VASP, and we recommend that you inspect the source code for more details. From vasp.6 onward, an improved scheme has been implemented and can be selected using {{TAG|LORBIT}}=14. In this case, VASP first selects a single projector for each <math>l</math>-quantum number by linearly combining all projectors with the same <math>l</math>-quantum number. This is done in such a way that the new projector is optimally chosen to represent the calculated orbitals in the energy interval specified by {{TAG|EMAX}} and {{TAG|EMIN}}. In the second step, VASP projects onto these optimized projectors, yielding a single complex number for each orbital, site and <math>l</math>-quantum number, which is written to the {{FILE|PROCAR}} file. For details we also refer to {{cite|Schuler:JPCM:2018}}.
{{TAG|LORBIT}}=12 should no longer be used except for qualitative calculations. LORBIT=13 chooses the projectors also automatically, but allows for different optimal linear combinations for each orbital.
Note that this is generally not desirable, since the  resultant projection is not compatible with the required properties of a projection operator (a projection operator needs to use energy and orbital independent projectors).
Hence, do not use {{TAG|LORBIT}}=13 for anything but a qualitative analysis.

{{TAG|LORBIT}}=13 and {{TAG|LORBIT}}=14 are only supported by version >=5.4.4.

== On-site partial charge densities and magnetization ==

The partial charge densities can be found in the {{FILE|OUTCAR}}
 total charge

 # of ion       s       p       d       tot
 ------------------------------------------
     1        1.514   0.000   0.000   1.514
     2        0.123   0.345   0.000   0.468
Here, the first column corresponds to the ion index <math>\alpha</math>, the s, p, d,... columns correspond to the partial charges for <math>l=0,1,2,\cdots</math> defined as

<math>\rho_{\alpha l}=\frac{1}{N_{\bf k}} \sum_{n{\bf k}}f_{n{\bf k}} \sum_{m=-l}^{l}|\langle Y_{lm}^{\alpha}|\phi_{n\mathbf{k}}\rangle|^2
</math>

The <math>\langle Y_{lm}^{\alpha}|\phi_{n\mathbf{k}}\rangle</math> are obtained from the projection of the (occupied) KS orbitals <math>|\phi_{n{\bf k}}\rangle</math> onto spherical harmonics that are non zero within spheres of a radius {{TAG|RWIGS}} centered at ion <math>\alpha</math> and the last column is the sum <math>\sum_{l}\rho_{\alpha l}</math>.

Note that depending on the system, an "f" column is written as well.

*In case of spin-polarized magnetic calculations ({{TAG|ISPIN}}=2), the partial magnetization densities are written to the {{FILE|OUTCAR}}
 magnetization (x)

 # of ion       s       p       d       tot
 ------------------------------------------
     1        0.000   0.000   0.000   0.000
     2        0.000   0.245   0.000   0.245

Here, the magnetization density is calculated from the difference in the up and down spin channel <math>m^{\alpha l}_z = \rho_{\alpha l}^{\uparrow}-\rho_{\alpha l}^{\downarrow}
</math>
Although the direction of the magnetization densities is meaningless in a spin-polarized calculation (no spin-orbit coupling, see {{TAG|LSORBIT}}), here the projection axis is the z-axis. This is consistent withe the behavior upon restarting a noncollinear calculation from a spin-polarized one with default {{TAG|SAXIS}}.

*In case of noncollinear calculations ({{TAG|LNONCOLLINEAR}}=.TRUE.), the lines after "total charge" correspond to the diagonal average
<math> \frac{\rho_{\alpha l}^{\uparrow\uparrow} - \rho_{\alpha l}^{\downarrow \downarrow}}{2} </math>
of the density tensor

::<math>
\rho_{\alpha l} = \left(\begin{matrix}
  \rho_{\alpha l}^{\uparrow \uparrow }   &  \rho_{\alpha l}^{\uparrow \downarrow}     \\
  \rho_{\alpha l}^{\downarrow \uparrow}  &  \rho_{\alpha l}^{\downarrow \downarrow}   \\
 \end{matrix}\right),
</math>

which is determined from the projected components

::<math>
\rho^{\mu\nu}_{\alpha l} = \frac{1}{N_{\bf k}} \sum_{n{\bf k}}f_{n{\bf k}} \sum_{m=-l}^{l}
\langle \chi_{n {\bf k}}^\mu | Y_{lm}^\alpha \rangle
\langle  Y_{lm}^\alpha | \chi_{n {\bf k}}^\nu \rangle
</math>

of the spinor <math>|\Psi_{n{\bf k}}\rangle=\left(\begin{matrix}\chi_{n{\bf k}}^\uparrow \\\chi_{n{\bf k}}^\downarrow \end{matrix}\right)</math>

Similarly, the lines after "magnetization (x)", "magnetization (y)", and "magnetization (z)"correspond to the partial magnetization density

::<math>
m_{\alpha l}^j = \frac{1}{2}\sum_{\mu,\nu=1}^2 \sigma^j_{\mu \nu} \rho_{\alpha l}^{\mu \nu}.
</math>

projected onto Pauli matrices <math>\{\sigma_1</math>, <math>\sigma_2</math>, <math>\mathbf{\sigma}_3\}</math>. By default, this corresponds to Cartesian directions <math>\sigma_1=\hat x</math>, <math>\sigma_2 =\hat y</math>, <math>\sigma_3 = \hat z</math>, but the orientation can be changed using {{TAG|SAXIS}}.

== References ==
<references/>

== Related tags and articles ==
{{TAG|RWIGS}},
{{FILE|PROCAR}},
{{FILE|PROOUT}},
{{FILE|DOSCAR}}

{{sc|LORBIT|Examples|Examples that use this tag}}

[[Category:INCAR tag]][[Category:Electronic ground-state properties]][[Category:Density of states]][[Category:Band structure]]
